<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>traps events</name>
    <events>
        <include>global events</include>
        <include>gameplay stuff</include>
        <event-block sid="227827290332802">
            <conditions>
                <condition id="0" name="On function" sid="741191467400781" type="Function">
                    <param id="0" name="Name">&quot;time has passed&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <variable constant="0" name="deltaTime" sid="857004679723869" static="0" type="number">0</variable>
                <event-block sid="278529939378744">
                    <conditions />
                    <actions>
                        <action id="-9" name="Set value" sid="830996273618068" type="System">
                            <param id="0" name="Variable">deltaTime</param>
                            <param id="1" name="Value">Function.Param(0)</param>
                        </action>
                    </actions>
                </event-block>
                <comment>Ignore absence of less than 10 sec</comment>
                <event-block sid="331503936648156">
                    <conditions>
                        <condition id="-14" name="Compare variable" sid="187078355772580" type="System">
                            <param id="0" name="Variable">deltaTime</param>
                            <param id="1" name="Comparison">4</param>
                            <param id="2" name="Value">10</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="0" name="Call function" sid="922472815563280" type="Function">
                            <param id="0" name="Name">&quot;traps .simulateTime&quot;</param>
                            <param id="1" name="Parameter {n}">deltaTime</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="921284008469349">
            <conditions>
                <condition id="0" name="On function" sid="752542714840261" type="Function">
                    <param id="0" name="Name">&quot;traps .simulateTime&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <variable constant="1" name="timebloc" sid="625836116514235" static="0" type="number">4</variable>
                <variable constant="0" name="restant" sid="384687047515406" static="0" type="number">0</variable>
                <event-block sid="194235794000556">
                    <conditions />
                    <actions>
                        <action id="-9" name="Set value" sid="127105190769506" type="System">
                            <param id="0" name="Variable">restant</param>
                            <param id="1" name="Value">Function.Param(0) / 60</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="105680083456008">
                    <conditions>
                        <condition id="-23" name="While" sid="431170692293679" type="System" />
                        <condition id="-14" name="Compare variable" sid="970890296713422" type="System">
                            <param id="0" name="Variable">restant</param>
                            <param id="1" name="Comparison">4</param>
                            <param id="2" name="Value">0</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <comment>1 block of time</comment>
                        <event-block sid="368434544033467">
                            <conditions>
                                <condition id="-14" name="Compare variable" sid="904825440162794" type="System">
                                    <param id="0" name="Variable">restant</param>
                                    <param id="1" name="Comparison">5</param>
                                    <param id="2" name="Value">TIMEBLOC</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="856094115511851">
                                    <conditions>
                                        <condition id="-11" name="For Each" sid="851329983815427" type="System">
                                            <param id="0" name="Object">3trap</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>there&apos;s a mon</comment>
                                        <event-block sid="876157881656161">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="492012577566673" type="3trap">
                                                    <param id="0" name="Instance variable">visitorId</param>
                                                    <param id="1" name="Comparison">1</param>
                                                    <param id="2" name="Value">-1</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-12" name="Subtract from" sid="483501588285701" type="3trap">
                                                    <param id="0" name="Instance variable">minutesRemaining</param>
                                                    <param id="1" name="Value">TIMEBLOC</param>
                                                </action>
                                            </actions>
                                            <sub-events>
                                                <comment>mon is gone</comment>
                                                <event-block sid="827542540895803">
                                                    <conditions>
                                                        <condition id="-7" name="Compare instance variable" sid="681129055259841" type="3trap">
                                                            <param id="0" name="Instance variable">minutesRemaining</param>
                                                            <param id="1" name="Comparison">3</param>
                                                            <param id="2" name="Value">0</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="-10" name="Set value" sid="866173730105609" type="3trap">
                                                            <param id="0" name="Instance variable">visitorId</param>
                                                            <param id="1" name="Value">-1</param>
                                                        </action>
                                                        <action id="-10" name="Set value" sid="332623101207398" type="3trap">
                                                            <param id="0" name="Instance variable">minutesRemaining</param>
                                                            <param id="1" name="Value">0</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                        <comment>Trap is empty</comment>
                                        <event-block sid="995983242889859">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="950957511835279" type="System" />
                                            </conditions>
                                            <actions />
                                            <sub-events>
                                                <comment>check if new mon</comment>
                                                <event-block sid="260362210339063">
                                                    <conditions />
                                                    <actions />
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-block sid="779204993158516">
                                    <conditions />
                                    <actions />
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>less than 1 block of time</comment>
                        <event-block sid="977740402666214">
                            <conditions>
                                <condition id="-22" name="Else" sid="463158224290592" type="System" />
                            </conditions>
                            <actions />
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-block>
        <event-group description="" sid="941902649631225" title="AJAX request (traps)">
            <sub-events>
                <comment>Request the json once per day (it also triggers on the first start, for a New Game)</comment>
                <event-block sid="474135525523124">
                    <conditions>
                        <condition id="1" name="Is online" sid="342637408275274" type="Browser" />
                        <condition id="-7" inverted="1" name="Compare instance variable" sid="217659171967679" type="3trapsJSON">
                            <param id="0" name="Instance variable">date</param>
                            <param id="1" name="Comparison">0</param>
                            <param id="2" name="Value">date.Date</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Request project file" sid="983872325896409" type="AJAX">
                            <param id="0" name="Tag">&quot;mons.json&quot;</param>
                            <param id="1" name="File">mons.json</param>
                        </action>
                        <action id="-10" name="Set value" sid="570607403618910" type="3trapsJSON">
                            <param id="0" name="Instance variable">date</param>
                            <param id="1" name="Value">Date.Date</param>
                        </action>
                    </actions>
                </event-block>
                <comment>if the internet was down the first time you launched the game and the array is still empty, this will make sure you&apos;re quickly back on track by trying every 15 sec</comment>
                <event-block sid="850054465330936">
                    <conditions>
                        <condition id="70" name="Is Empty" sid="284789509293068" type="3trapsJSON">
                            <param id="0" name="Reference point">0</param>
                            <param id="1" name="Key {n}"></param>
                        </condition>
                        <condition id="1" name="Is online" sid="821078781737790" type="Browser" />
                        <condition id="-6" name="Every X seconds" sid="939480123943461" type="System">
                            <param id="0" name="Interval (seconds)">15</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Request project file" sid="423401574443775" type="AJAX">
                            <param id="0" name="Tag">&quot;mons.json&quot;</param>
                            <param id="1" name="File">mons.json</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="970818881138967">
                    <conditions>
                        <condition id="0" name="On completed" sid="727140558703871" type="AJAX">
                            <param id="0" name="Tag">&quot;mons.json&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="60" name="LoadJSON" sid="609327474889873" type="3trapsJSON">
                            <param id="0" name="JSON">AJAX.LastData</param>
                            <param id="1" name="Reference point">0</param>
                            <param id="2" name="Key {n}"></param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="690716924661973">
                    <conditions>
                        <condition id="1" name="On error" sid="404330999851662" type="AJAX">
                            <param id="0" name="Tag">&quot;mons.json&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="14" name="Log" sid="421414331579897" type="Browser">
                            <param id="0" name="Type">1</param>
                            <param id="1" name="Message">&quot;Tried to retrieve mons.json but couldn&apos;t. Probably because internet connection is missing. Will try again later.&quot;</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="950896162275799">
                    <conditions>
                        <condition id="200" name="On JSON Parse Error" sid="582516010564090" type="3trapsJSON" />
                    </conditions>
                    <actions>
                        <action id="14" name="Log" sid="514927499061973" type="Browser">
                            <param id="0" name="Type">1</param>
                            <param id="1" name="Message">&quot;The mons.json is not formated properly.&quot;</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="" sid="753817922202577" title="JSON functions (traps)">
            <sub-events>
                <event-block sid="123617965027594">
                    <conditions>
                        <condition id="0" name="On function" sid="298404752182894" type="Function">
                            <param id="0" name="Name">&quot;mons .count&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Set return value" sid="697573811616964" type="Function">
                            <param id="0" name="Value">3trapsJSON.Size(0, &quot;mons&quot;)</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="477188139944862">
                    <conditions>
                        <condition id="0" name="On function" sid="659016455534248" type="Function">
                            <param id="0" name="Name">&quot;mons .name&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <variable constant="0" name="id" sid="100458996011092" static="0" type="number">0</variable>
                        <event-block sid="462651539278311">
                            <conditions />
                            <actions>
                                <action id="-9" name="Set value" sid="425932272756387" type="System">
                                    <param id="0" name="Variable">id</param>
                                    <param id="1" name="Value">Function.Param(0)</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="306108708430075">
                            <conditions />
                            <actions>
                                <action id="1" name="Set return value" sid="642553363933477" type="Function">
                                    <param id="0" name="Value">3trapsJSON.Value(0, &quot;mons&quot;, id, &quot;name&quot;)</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="821863189007117">
                    <conditions>
                        <condition id="0" name="On function" sid="969416389655742" type="Function">
                            <param id="0" name="Name">&quot;mons .duration&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <variable constant="0" name="id" sid="457782863900060" static="0" type="number">0</variable>
                        <event-block sid="747312273509829">
                            <conditions />
                            <actions>
                                <action id="-9" name="Set value" sid="268123885150047" type="System">
                                    <param id="0" name="Variable">id</param>
                                    <param id="1" name="Value">Function.Param(0)</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="864828423975561">
                            <conditions />
                            <actions>
                                <action id="1" name="Set return value" sid="624335382913801" type="Function">
                                    <param id="0" name="Value">3trapsJSON.Value(0, &quot;mons&quot;, id, &quot;duration&quot;)</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="127761091134967">
                    <conditions>
                        <condition id="0" name="On function" sid="438217543000802" type="Function">
                            <param id="0" name="Name">&quot;mons .gift&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <variable constant="0" name="id" sid="380853355695748" static="0" type="number">0</variable>
                        <event-block sid="318996005027027">
                            <conditions />
                            <actions>
                                <action id="-9" name="Set value" sid="436508474210798" type="System">
                                    <param id="0" name="Variable">id</param>
                                    <param id="1" name="Value">Function.Param(0)</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="288204887004785">
                            <conditions />
                            <actions>
                                <action id="1" name="Set return value" sid="531312288963452" type="Function">
                                    <param id="0" name="Value">3trapsJSON.Value(0, &quot;mons&quot;, id, &quot;gift&quot;)</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="" sid="799838731313010" title="debug (traps)">
            <sub-events>
                <event-block sid="332699366555795">
                    <conditions>
                        <condition id="-6" name="Every X seconds" sid="264565433427546" type="System">
                            <param id="0" name="Interval (seconds)">1</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action disabled="1" id="14" name="Log" sid="698703762127055" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;before&quot;</param>
                        </action>
                        <action disabled="1" id="14" name="Log" sid="208905483803146" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;debug: &quot; &amp; Function.Call(&quot;mons .gift&quot;, 2)</param>
                        </action>
                        <action disabled="1" id="14" name="Log" sid="578464219814689" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;after&quot;</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-group>
        <event-block sid="697821194007688">
            <conditions>
                <condition id="-6" name="Every X seconds" sid="696162746251300" type="System">
                    <param id="0" name="Interval (seconds)">0.1</param>
                </condition>
                <condition id="-11" name="For Each" sid="929912707935820" type="System">
                    <param id="0" name="Object">3trap</param>
                </condition>
            </conditions>
            <actions>
                <action id="0" name="Set text" sid="943839193267388" type="3trapsTxt">
                    <param id="0" name="Text">&quot;&quot;</param>
                </action>
            </actions>
            <sub-events>
                <event-block sid="736452608725933">
                    <conditions>
                        <condition id="-7" name="Compare instance variable" sid="636465651992512" type="3trap">
                            <param id="0" name="Instance variable">visitorId</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Value">-1</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="0" name="Set text" sid="977291409766435" type="3trapsTxt">
                            <param id="0" name="Text">Function.Call(&quot;mons .name&quot;, 3trap.visitorId)</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="340790824484576">
                    <conditions>
                        <condition id="-22" name="Else" sid="672513958344978" type="System" />
                    </conditions>
                    <actions>
                        <action id="0" name="Set text" sid="459426892854914" type="3trapsTxt">
                            <param id="0" name="Text">&quot;---&quot;</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="329986872480882">
                    <conditions />
                    <actions>
                        <action id="1" name="Append text" sid="772207875819413" type="3trapsTxt">
                            <param id="0" name="Text">newline &amp; &quot;time:&quot; &amp; round(3trap.minutesRemaining*60)</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
    </events>
</c2eventsheet>
